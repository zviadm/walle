syntax = "proto3";
option go_package = "github.com/zviadm/walle/proto/topomgr";

import "google/protobuf/empty.proto";
import "walleapi/walleapi.proto";

service TopoManager {
	rpc FetchTopology(FetchTopologyRequest) returns (Topology) {}
	// TODO(zviad): This method may not be needed.
	rpc UpdateTopology(UpdateTopologyRequest) returns (google.protobuf.Empty) {}

	rpc UpdateServerInfo(UpdateServerInfoRequest) returns (google.protobuf.Empty) {}
	rpc UpdateServerIds(UpdateServerIdsRequest) returns (google.protobuf.Empty) {}
}

message FetchTopologyRequest {
	string topology_uri = 1;
}
message UpdateTopologyRequest {
	string topology_uri = 1;
	Topology topology = 2;
}

message UpdateServerInfoRequest {
	string topology_uri = 1;
	string server_id = 2;
	ServerInfo server_info = 3;
}
message UpdateServerIdsRequest {
	string topology_uri = 1;
	string stream_uri = 2;
	repeated string server_ids = 3;
}